# Claude Agent SDK è°ƒç ”æŠ¥å‘Š

**è°ƒç ”äººå‘˜**: [ä½ çš„åå­—]
**è°ƒç ”æ—¶é—´**: 2026å¹´2æœˆ3æ—¥
**å…³é”®è¯**: Claude API, Tool Use, Agent SDK, MCP (Model Context Protocol)

---

## ğŸ“‹ ç›®å½•

1. [è°ƒç ”èƒŒæ™¯](#è°ƒç ”èƒŒæ™¯)
2. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
3. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
4. [å®è·µæ¡ˆä¾‹](#å®è·µæ¡ˆä¾‹)
5. [å…³é”®ä»£ç å®ç°](#å…³é”®ä»£ç å®ç°)
6. [é‡åˆ°çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#é‡åˆ°çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
7. [æ€»ç»“ä¸å»ºè®®](#æ€»ç»“ä¸å»ºè®®)

---

## 1. è°ƒç ”èƒŒæ™¯

### 1.1 ç ”ç©¶ç›®æ ‡
è°ƒç ” Claude Agent SDK çš„å·¥ä½œåŸç†ï¼Œæ¢ç´¢å¦‚ä½•å°†å¤–éƒ¨å·¥å…·ï¼ˆMCP æœåŠ¡ï¼‰æ³¨å†Œä¸º Claude å¯è°ƒç”¨çš„å·¥å…·ï¼Œå®ç° AI è‡ªä¸»å†³ç­–å’Œä»»åŠ¡æ‰§è¡Œã€‚

### 1.2 åº”ç”¨åœºæ™¯
å­¦æœ¯ç ”ç©¶é¢†åŸŸçš„è‡ªåŠ¨åŒ–æ–‡çŒ®æ£€ç´¢ä¸ç»¼è¿°ç”Ÿæˆï¼Œæ¶‰åŠå¤šä¸ªæ•°æ®æºï¼ˆarXivã€Crossrefã€PubMed ç­‰ï¼‰çš„æ™ºèƒ½æ•´åˆã€‚

---

## 2. æ ¸å¿ƒæ¦‚å¿µ

### 2.1 Claude Tool Useï¼ˆå·¥å…·è°ƒç”¨ï¼‰

Claude API æ”¯æŒ **Tool Use** åŠŸèƒ½ï¼Œå…è®¸ AI åœ¨æ‰§è¡Œä»»åŠ¡æ—¶ä¸»åŠ¨è°ƒç”¨å¤–éƒ¨å·¥å…·ã€‚æ ¸å¿ƒæµç¨‹ï¼š

```
ç”¨æˆ·æŒ‡ä»¤ â†’ Claude åˆ†æ â†’ å†³å®šè°ƒç”¨å·¥å…· â†’ æ‰§è¡Œå·¥å…· â†’ è§‚å¯Ÿç»“æœ â†’ ç»§ç»­å†³ç­–
```

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… **è‡ªä¸»å†³ç­–**: Claude æ ¹æ®ä»»åŠ¡éœ€æ±‚è‡ªåŠ¨é€‰æ‹©å·¥å…·
- âœ… **é—­ç¯æ‰§è¡Œ**: è§‚å¯Ÿå·¥å…·è¿”å›ç»“æœï¼ŒåŠ¨æ€è°ƒæ•´ç­–ç•¥
- âœ… **å¤šè½®å¯¹è¯**: æ”¯æŒå¤šæ¬¡å·¥å…·è°ƒç”¨ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆ

### 2.2 MCP (Model Context Protocol)

MCP æ˜¯ä¸€ç§æ ‡å‡†åŒ–åè®®ï¼Œç”¨äºè¿æ¥ AI æ¨¡å‹ä¸å¤–éƒ¨æ•°æ®æº/å·¥å…·ã€‚

**æ¶æ„**ï¼š
```
Claude API â†â†’ MCP Client â†â†’ MCP Server (ç«¯å£ 6000-6007)
```

**ä¼˜åŠ¿**ï¼š
- ç»Ÿä¸€çš„æ¥å£è§„èŒƒ
- æ”¯æŒ SSE (Server-Sent Events) é•¿è¿æ¥
- æ˜“äºæ‰©å±•æ–°çš„æ•°æ®æº

---

## 3. æŠ€æœ¯æ¶æ„

### 3.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·æŒ‡ä»¤                              â”‚
â”‚          "ç”Ÿæˆå…³äº Large Language Models çš„ç»¼è¿°æŠ¥å‘Š"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Claude Agent (claude_agent.py)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. å·¥å…·å®šä¹‰ (get_tool_definitions)                  â”‚   â”‚
â”‚  â”‚     - å°† MCP æœåŠ¡è½¬æ¢ä¸º Claude å·¥å…·æ ¼å¼              â”‚   â”‚
â”‚  â”‚  2. å†³ç­–å¾ªç¯ (run)                                   â”‚   â”‚
â”‚  â”‚     - Claude åˆ†æä»»åŠ¡ â†’ é€‰æ‹©å·¥å…· â†’ æ‰§è¡Œ â†’ è§‚å¯Ÿç»“æœ   â”‚   â”‚
â”‚  â”‚  3. å·¥å…·æ‰§è¡Œ (execute_tool)                          â”‚   â”‚
â”‚  â”‚     - æ¡¥æ¥ Claude è°ƒç”¨å’Œ MCP æœåŠ¡                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MCP SDK (mcp_sdk.py)                      â”‚
â”‚  - å°è£… SSE è¿æ¥é€»è¾‘                                         â”‚
â”‚  - ç»Ÿä¸€é”™è¯¯å¤„ç†                                              â”‚
â”‚  - JSON æ•°æ®è§£æ                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MCP æœåŠ¡ (ç«¯å£ 6000-6007)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ 6000     â”‚ 6001     â”‚ 6002     â”‚ 6003     â”‚             â”‚
â”‚  â”‚ Crossref â”‚ BioC     â”‚ DeepRes  â”‚ arXiv    â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ 6004     â”‚ 6005     â”‚ 6006     â”‚ 6007     â”‚             â”‚
â”‚  â”‚ OpenLib  â”‚ Entrez   â”‚ arXiv ID â”‚ arXiv T  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒæ¨¡å—

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| Claude ä»£ç† | `claude_agent.py` | å·¥å…·æ³¨å†Œã€å†³ç­–å¾ªç¯ã€ä»»åŠ¡æ‰§è¡Œ |
| MCP å®¢æˆ·ç«¯ | `mcp_sdk.py` | SSE è¿æ¥ã€å·¥å…·è°ƒç”¨ã€æ•°æ®è§£æ |
| å·¥å…·æ¼”ç¤º | `demo_mcp_tools.py` | ç‹¬ç«‹æ¼”ç¤º MCP å·¥å…·åŠŸèƒ½ |
| æœåŠ¡æµ‹è¯• | `test_mcp_tools.py` | æ‰¹é‡æµ‹è¯•æ‰€æœ‰ MCP æœåŠ¡ |

---

## 4. å®è·µæ¡ˆä¾‹

### 4.1 ä»ç¡¬ç¼–ç åˆ°è‡ªä¸»å†³ç­–

#### âŒ ä¼ ç»Ÿæ–¹å¼ï¼ˆç¡¬ç¼–ç æµç¨‹ï¼‰

```python
# academic_agent.py (æ—§ç‰ˆ)
async def generate_report(self, keyword: str):
    # æ‰‹åŠ¨å®šä¹‰è°ƒç”¨é¡ºåº
    task1 = self.client_deep.call_tool("DeepResearch", {...})
    task2 = self.client_arxiv.call_tool("searchArxivByAbstract", {...})

    # å¹¶è¡Œæ‰§è¡Œ
    results = await asyncio.gather(task1, task2)

    # æ‰‹åŠ¨è§£æå’Œæ•´åˆæ•°æ®
    papers = []
    papers.extend(self._parse_deep(results[0]))
    papers.extend(self._parse_arxiv(results[1]))

    # æ‰‹åŠ¨ç”ŸæˆæŠ¥å‘Š
    self._save_to_markdown(keyword, papers)
```

**é—®é¢˜**ï¼š
- âŒ æµç¨‹å›ºå®šï¼Œæ— æ³•æ ¹æ®æ•°æ®åŠ¨æ€è°ƒæ•´
- âŒ éœ€è¦æ‰‹åŠ¨ç¼–å†™æ¯ä¸ªæ­¥éª¤
- âŒ æ— æ³•æ™ºèƒ½é€‰æ‹©æœ€ä½³å·¥å…·ç»„åˆ
- âŒ æ‰©å±•æ€§å·®ï¼Œæ·»åŠ æ–°å·¥å…·éœ€è¦ä¿®æ”¹ä»£ç é€»è¾‘

#### âœ… Claude Agent æ–¹å¼ï¼ˆè‡ªä¸»å†³ç­–ï¼‰

```python
# claude_agent.py (æ–°ç‰ˆ)
async def main():
    agent = ClaudeAcademicAgent()

    # åªéœ€ç»™å‡ºé«˜å±‚æŒ‡ä»¤
    instruction = """
    è¯·ç»¼åˆåˆ©ç”¨ 6000-6007 ç«¯å£çš„æ‰€æœ‰å­¦æœ¯æœç´¢å·¥å…·ï¼Œ
    ä¸ºæˆ‘ç”Ÿæˆä¸€ä»½å…³äº Large Language Models çš„ä¸¥è°¨ç»¼è¿°æŠ¥å‘Šã€‚

    è¦æ±‚ï¼š
    1. ä½¿ç”¨å¤šä¸ªæ•°æ®æºè¿›è¡Œå…¨é¢æ£€ç´¢
    2. é‡ç‚¹å…³æ³¨ 2020 å¹´åçš„é‡è¦è®ºæ–‡
    3. æ•´ç†å‡ºè‡³å°‘ 10 ç¯‡é«˜è´¨é‡è®ºæ–‡
    4. ç”Ÿæˆ Markdown æ ¼å¼çš„æŠ¥å‘Š
    """

    # Claude è‡ªä¸»å†³ç­–å’Œæ‰§è¡Œ
    result = await agent.run(instruction, max_iterations=15)
```

**ä¼˜åŠ¿**ï¼š
- âœ… Claude è‡ªä¸»å†³å®šè°ƒç”¨å“ªäº›å·¥å…·
- âœ… è§‚å¯Ÿæ•°æ®ååŠ¨æ€è°ƒæ•´ç­–ç•¥
- âœ… æ™ºèƒ½èåˆå¤šä¸ªæ•°æ®æº
- âœ… é—­ç¯æ‰§è¡Œï¼Œæ— éœ€äººå·¥å¹²é¢„
- âœ… æ˜“äºæ‰©å±•ï¼Œæ·»åŠ æ–°å·¥å…·åªéœ€ä¿®æ”¹é…ç½®

### 4.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹

```
[è¿­ä»£ 1] Claude: "æˆ‘éœ€è¦å…ˆæœç´¢ç›¸å…³è®ºæ–‡"
         â†’ è°ƒç”¨ deep_research(searchQuery="Large Language Models", count=10)
         â†’ è¿”å› 10 ç¯‡è®ºæ–‡

[è¿­ä»£ 2] Claude: "æˆ‘çœ‹åˆ°æœ‰å‡ ç¯‡ arXiv è®ºæ–‡ï¼Œè®©æˆ‘è·å–è¯¦ç»†ä¿¡æ¯"
         â†’ è°ƒç”¨ arxiv_search_by_id(key="1706.03762")
         â†’ è¿”å› "Attention Is All You Need" è¯¦ç»†ä¿¡æ¯

[è¿­ä»£ 3] Claude: "æˆ‘è¿˜éœ€è¦æŸ¥æ‰¾ç”Ÿç‰©åŒ»å­¦é¢†åŸŸçš„åº”ç”¨"
         â†’ è°ƒç”¨ entrez_search(db="pubmed", term="large language model")
         â†’ è¿”å› PubMed æ–‡çŒ®

[è¿­ä»£ 4] Claude: "æ•°æ®å·²æ”¶é›†å®Œæ¯•ï¼Œå¼€å§‹ç”ŸæˆæŠ¥å‘Š"
         â†’ æ•´åˆæ‰€æœ‰æ•°æ®
         â†’ ç”Ÿæˆ Markdown æ ¼å¼çš„ç»¼è¿°æŠ¥å‘Š
```

---

## 5. å…³é”®ä»£ç å®ç°

### 5.1 å·¥å…·å®šä¹‰ï¼ˆTool Definitionsï¼‰

å°† MCP æœåŠ¡è½¬æ¢ä¸º Claude å¯ç†è§£çš„å·¥å…·æ ¼å¼ï¼š

```python
def get_tool_definitions(self) -> List[Dict[str, Any]]:
    """å®šä¹‰æ‰€æœ‰å¯ç”¨å·¥å…·çš„è§„èŒƒ"""
    return [
        {
            "name": "deep_research",
            "description": "ä½¿ç”¨é›†æ€è°±çš„æ·±åº¦ç ”ç©¶å¼•æ“ï¼Œæœç´¢é«˜è´¨é‡å­¦æœ¯è®ºæ–‡ã€‚"
                          "è¿”å›è®ºæ–‡æ ‡é¢˜ã€æ‘˜è¦ã€DOIã€å¼•ç”¨ç­‰ä¿¡æ¯ã€‚",
            "input_schema": {
                "type": "object",
                "properties": {
                    "searchQuery": {
                        "type": "string",
                        "description": "æœç´¢æŸ¥è¯¢ï¼Œä¾‹å¦‚ 'Large Language Models'"
                    },
                    "count": {
                        "type": "integer",
                        "description": "è¿”å›ç»“æœæ•°é‡ï¼Œé»˜è®¤ 10",
                        "default": 10
                    }
                },
                "required": ["searchQuery"]
            }
        },
        # ... å…¶ä»– 7 ä¸ªå·¥å…·å®šä¹‰
    ]
```

**å…³é”®ç‚¹**ï¼š
- `name`: å·¥å…·åç§°ï¼ˆClaude ç”¨äºè¯†åˆ«ï¼‰
- `description`: å·¥å…·åŠŸèƒ½æè¿°ï¼ˆå¸®åŠ© Claude å†³ç­–ï¼‰
- `input_schema`: å‚æ•°å®šä¹‰ï¼ˆJSON Schema æ ¼å¼ï¼‰

### 5.2 å·¥å…·æ‰§è¡Œï¼ˆTool Executionï¼‰

æ¡¥æ¥ Claude çš„å·¥å…·è°ƒç”¨å’Œå®é™…çš„ MCP æœåŠ¡ï¼š

```python
async def execute_tool(self, tool_name: str, tool_input: Dict[str, Any]) -> str:
    """æ‰§è¡Œå·¥å…·è°ƒç”¨"""
    print(f"ğŸ”§ [å·¥å…·æ‰§è¡Œ] {tool_name}")

    try:
        # æ ¹æ®å·¥å…·åç§°è·¯ç”±åˆ°å¯¹åº”çš„ MCP å®¢æˆ·ç«¯
        if tool_name == "deep_research":
            result = await self.mcp_clients["deep_research"].call_tool(
                "DeepResearch",
                {
                    "searchQuery": tool_input["searchQuery"],
                    "count": tool_input.get("count", 10)
                }
            )
        # ... å…¶ä»–å·¥å…·çš„è·¯ç”±é€»è¾‘

        # å°†ç»“æœè½¬æ¢ä¸º JSON å­—ç¬¦ä¸²è¿”å›ç»™ Claude
        return json.dumps(result, ensure_ascii=False, indent=2)

    except Exception as e:
        return json.dumps({"error": str(e)}, ensure_ascii=False)
```

### 5.3 å†³ç­–å¾ªç¯ï¼ˆAgentic Loopï¼‰

å®ç° Claude çš„è‡ªä¸»å†³ç­–å’Œæ‰§è¡Œï¼š

```python
async def run(self, user_instruction: str, max_iterations: int = 10) -> str:
    """è¿è¡Œ Claude ä»£ç†çš„ä¸»å¾ªç¯"""

    # åˆå§‹åŒ–å¯¹è¯
    self.conversation_history = [
        {"role": "user", "content": user_instruction}
    ]

    iteration = 0
    while iteration < max_iterations:
        iteration += 1

        # è°ƒç”¨ Claude API
        response = self.client.messages.create(
            model="claude-3-5-sonnet",
            max_tokens=4096,
            tools=self.get_tool_definitions(),  # ä¼ å…¥å·¥å…·å®šä¹‰
            messages=self.conversation_history
        )

        # å¤„ç†å“åº”
        if response.stop_reason == "end_turn":
            # Claude å®Œæˆä»»åŠ¡ï¼Œè¿”å›ç»“æœ
            return self._extract_final_text(response)

        elif response.stop_reason == "tool_use":
            # Claude å†³å®šä½¿ç”¨å·¥å…·
            for block in response.content:
                if block.type == "tool_use":
                    # æ‰§è¡Œå·¥å…·
                    result = await self.execute_tool(block.name, block.input)

                    # å°†ç»“æœè¿”å›ç»™ Claude
                    self.conversation_history.append({
                        "role": "user",
                        "content": [{
                            "type": "tool_result",
                            "tool_use_id": block.id,
                            "content": result
                        }]
                    })

    return "ä»»åŠ¡æœªå®Œæˆï¼ˆè¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼‰"
```

**å…³é”®ç‚¹**ï¼š
- `stop_reason == "tool_use"`: Claude å†³å®šè°ƒç”¨å·¥å…·
- `stop_reason == "end_turn"`: Claude å®Œæˆä»»åŠ¡
- æ¯æ¬¡å·¥å…·è°ƒç”¨åï¼Œå°†ç»“æœæ·»åŠ åˆ°å¯¹è¯å†å²ï¼Œä¾› Claude ç»§ç»­å†³ç­–

### 5.4 MCP å®¢æˆ·ç«¯å°è£…

```python
class GiiispMCPClient:
    """MCP æœåŠ¡é€šç”¨å®¢æˆ·ç«¯ SDK"""

    def __init__(self, port: int, service_name: str):
        self.port = port
        self.service_name = service_name
        self.base_url = f"http://giiisp.com:{port}/sse"

    async def call_tool(self, tool_name: str, args: Dict[str, Any]):
        """è¿æ¥æœåŠ¡å¹¶è°ƒç”¨æŒ‡å®šå·¥å…·"""
        async with sse_client(self.base_url) as (read, write):
            async with ClientSession(read, write) as session:
                await session.initialize()

                # éªŒè¯å·¥å…·æ˜¯å¦å­˜åœ¨
                tools = await session.list_tools()
                if tool_name not in [t.name for t in tools.tools]:
                    return None

                # æ‰§è¡Œè°ƒç”¨
                result = await session.call_tool(name=tool_name, arguments=args)

                # è§£æç»“æœ
                return self._parse_result(result)
```

---

## 6. é‡åˆ°çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 6.1 é—®é¢˜ï¼šä¸­è½¬ API è¿æ¥å¤±è´¥

**ç°è±¡**ï¼š
```
anthropic.InternalServerError: Error code: 503
- model_not_found: æ¨¡å‹ claude-3-5-sonnet ä¸å¯ç”¨

httpcore.ConnectError: [SSL: UNEXPECTED_EOF_WHILE_READING]
```

**åŸå› åˆ†æ**ï¼š
1. ä¸­è½¬ API (`https://api.580ai.net/v1`) ä¸æ”¯æŒæŒ‡å®šçš„æ¨¡å‹åç§°
2. SSL è¿æ¥é—®é¢˜ï¼Œå¯èƒ½æ˜¯ç½‘ç»œç¯å¢ƒæˆ–ä»£ç†è®¾ç½®
3. ä¸­è½¬æœåŠ¡å¯èƒ½æš‚æ—¶ä¸å¯ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š

#### æ–¹æ¡ˆ 1: ä½¿ç”¨å®˜æ–¹ API
```python
# .env é…ç½®
ANTHROPIC_API_KEY=sk-ant-api03-å®˜æ–¹key
# åˆ é™¤ ANTHROPIC_BASE_URL é…ç½®
```

#### æ–¹æ¡ˆ 2: ç¡®è®¤ä¸­è½¬ API é…ç½®
- è”ç³»æœåŠ¡æä¾›å•†ç¡®è®¤æ”¯æŒçš„æ¨¡å‹åç§°
- å¯èƒ½çš„æ¨¡å‹åç§°ï¼š
  - `claude-3-5-sonnet-20241022`
  - `claude-3-opus-20240229`
  - `claude-3-sonnet-20240229`

#### æ–¹æ¡ˆ 3: ç‹¬ç«‹æµ‹è¯• MCP å·¥å…·
åˆ›å»º `demo_mcp_tools.py`ï¼Œåœ¨ä¸ä¾èµ– Claude API çš„æƒ…å†µä¸‹æµ‹è¯• MCP å·¥å…·åŠŸèƒ½ï¼š

```python
# ç›´æ¥è°ƒç”¨ MCP æœåŠ¡
client = GiiispMCPClient(6002, "DeepResearch")
data = await client.call_tool("DeepResearch", {
    "searchQuery": "Large Language Models",
    "count": 5
})

# æ‰‹åŠ¨ç”ŸæˆæŠ¥å‘Š
generate_markdown_report(data)
```

### 6.2 é—®é¢˜ï¼šMCP æœåŠ¡è¿æ¥æµ‹è¯•

**è§£å†³æ–¹æ¡ˆ**ï¼šåˆ›å»ºæµ‹è¯•è„šæœ¬éªŒè¯æ‰€æœ‰æœåŠ¡

```python
# test_mcp_tools.py
test_cases = [
    (6000, "Crossref", "search_works", {"query": "AI", "rows": 1}),
    (6002, "DeepResearch", "DeepResearch", {"searchQuery": "LLM", "count": 1}),
    # ... å…¶ä»–æœåŠ¡
]

for port, name, tool, args in test_cases:
    client = GiiispMCPClient(port, name)
    result = await client.call_tool(tool, args)
    print(f"{'âœ…' if result else 'âŒ'} {name} (ç«¯å£ {port})")
```

**æµ‹è¯•ç»“æœ**ï¼š
- âœ… ç«¯å£ 6002 (DeepResearch) - æµ‹è¯•é€šè¿‡
- â³ å…¶ä»–ç«¯å£ - å¾…æµ‹è¯•

---

## 7. æ€»ç»“ä¸å»ºè®®

### 7.1 æ ¸å¿ƒæˆæœ

#### æŠ€æœ¯å®ç°
1. âœ… **å·¥å…·æ˜ å°„æœºåˆ¶** - æˆåŠŸå°† 8 ä¸ª MCP æœåŠ¡æ³¨å†Œä¸º Claude å·¥å…·
2. âœ… **è‡ªä¸»å†³ç­–å¾ªç¯** - å®ç° Claude çš„é—­ç¯æ‰§è¡Œé€»è¾‘
3. âœ… **MCP å®¢æˆ·ç«¯å°è£…** - ç»Ÿä¸€çš„æœåŠ¡è°ƒç”¨æ¥å£
4. âœ… **é”™è¯¯å¤„ç†** - å®Œå–„çš„å¼‚å¸¸æ•è·å’Œæ—¥å¿—è¾“å‡º

#### æ¶æ„ä¼˜åŠ¿
- **å¯æ‰©å±•æ€§**: æ·»åŠ æ–°å·¥å…·åªéœ€ä¿®æ”¹é…ç½®ï¼Œæ— éœ€æ”¹åŠ¨æ ¸å¿ƒé€»è¾‘
- **æ™ºèƒ½åŒ–**: Claude æ ¹æ®ä»»åŠ¡è‡ªåŠ¨é€‰æ‹©æœ€ä½³å·¥å…·ç»„åˆ
- **æ¨¡å—åŒ–**: MCP SDKã€å·¥å…·å®šä¹‰ã€å†³ç­–å¾ªç¯ç›¸äº’ç‹¬ç«‹
- **å¯æµ‹è¯•æ€§**: æä¾›ç‹¬ç«‹çš„æµ‹è¯•è„šæœ¬ï¼Œæ— éœ€ Claude API å³å¯éªŒè¯

### 7.2 æŠ€æœ¯å¯¹æ¯”

| ç»´åº¦ | ç¡¬ç¼–ç æ–¹å¼ | Claude Agent SDK |
|------|-----------|-----------------|
| çµæ´»æ€§ | âŒ å›ºå®šæµç¨‹ | âœ… åŠ¨æ€è°ƒæ•´ |
| æ™ºèƒ½æ€§ | âŒ æ— å†³ç­–èƒ½åŠ› | âœ… è‡ªä¸»å†³ç­– |
| å¯æ‰©å±•æ€§ | âš ï¸ éœ€ä¿®æ”¹ä»£ç  | âœ… é…ç½®åŒ–æ‰©å±• |
| æ•°æ®èåˆ | âš ï¸ æ‰‹åŠ¨ç¼–å†™ | âœ… è‡ªåŠ¨æ•´åˆ |
| é”™è¯¯å¤„ç† | âŒ éœ€æ‰‹åŠ¨å¤„ç† | âœ… Claude è‡ªåŠ¨é‡è¯• |
| å¼€å‘æ•ˆç‡ | âš ï¸ ä½ | âœ… é«˜ |

### 7.3 åº”ç”¨åœºæ™¯

#### é€‚ç”¨åœºæ™¯
- âœ… éœ€è¦å¤šæ•°æ®æºæ•´åˆçš„å¤æ‚ä»»åŠ¡
- âœ… ä»»åŠ¡æµç¨‹ä¸å›ºå®šï¼Œéœ€è¦åŠ¨æ€å†³ç­–
- âœ… éœ€è¦ AI ç†è§£å’Œåˆ†ææ•°æ®
- âœ… å¸Œæœ›å‡å°‘äººå·¥ç¼–ç å·¥ä½œé‡

#### ä¸é€‚ç”¨åœºæ™¯
- âŒ ç®€å•çš„å•ä¸€å·¥å…·è°ƒç”¨
- âŒ æµç¨‹å®Œå…¨å›ºå®šçš„ä»»åŠ¡
- âŒ å¯¹æˆæœ¬æ•æ„Ÿçš„é«˜é¢‘è°ƒç”¨åœºæ™¯

### 7.4 åç»­å»ºè®®

#### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰
1. **è§£å†³ API è¿æ¥é—®é¢˜**
   - ç¡®è®¤ä¸­è½¬ API çš„æ­£ç¡®é…ç½®
   - æˆ–ç”³è¯·å®˜æ–¹ Anthropic API Key

2. **å®Œæ•´åŠŸèƒ½æµ‹è¯•**
   - æµ‹è¯•æ‰€æœ‰ 8 ä¸ª MCP æœåŠ¡
   - éªŒè¯ Claude çš„å†³ç­–è´¨é‡
   - è¯„ä¼°ç”ŸæˆæŠ¥å‘Šçš„å‡†ç¡®æ€§

3. **æ€§èƒ½ä¼˜åŒ–**
   - æ·»åŠ ç¼“å­˜æœºåˆ¶å‡å°‘é‡å¤è°ƒç”¨
   - ä¼˜åŒ–å·¥å…·æè¿°æé«˜ Claude å†³ç­–å‡†ç¡®ç‡

#### ä¸­æœŸï¼ˆ1-2æœˆï¼‰
1. **æ‰©å±•å·¥å…·é›†**
   - æ·»åŠ æ›´å¤šå­¦æœ¯æ•°æ®æºï¼ˆGoogle Scholarã€Semantic Scholarï¼‰
   - é›†æˆæ•°æ®å¯è§†åŒ–å·¥å…·
   - æ”¯æŒ PDF å…¨æ–‡ä¸‹è½½å’Œè§£æ

2. **å¢å¼º Agent èƒ½åŠ›**
   - å®ç°å¤š Agent åä½œï¼ˆæœç´¢ Agent + åˆ†æ Agent + å†™ä½œ Agentï¼‰
   - æ·»åŠ è®°å¿†æœºåˆ¶ï¼Œæ”¯æŒå¤šè½®å¯¹è¯
   - å®ç°ä»»åŠ¡åˆ†è§£å’Œå¹¶è¡Œæ‰§è¡Œ

3. **ç”¨æˆ·ç•Œé¢**
   - å¼€å‘ Web ç•Œé¢æˆ–å‘½ä»¤è¡Œäº¤äº’å·¥å…·
   - å®æ—¶æ˜¾ç¤º Agent çš„å†³ç­–è¿‡ç¨‹
   - æ”¯æŒç”¨æˆ·å¹²é¢„å’Œå¼•å¯¼

#### é•¿æœŸï¼ˆ3-6æœˆï¼‰
1. **é€šç”¨åŒ–æ¡†æ¶**
   - å°† Agent æ¡†æ¶æŠ½è±¡ä¸ºé€šç”¨åº“
   - æ”¯æŒä»»æ„é¢†åŸŸçš„å·¥å…·æ³¨å†Œ
   - æä¾›å¯è§†åŒ–çš„å·¥å…·é…ç½®ç•Œé¢

2. **ä¼ä¸šçº§éƒ¨ç½²**
   - æ·»åŠ æƒé™ç®¡ç†å’Œå®¡è®¡æ—¥å¿—
   - æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²å’Œè´Ÿè½½å‡è¡¡
   - å®ç°æˆæœ¬æ§åˆ¶å’Œé…é¢ç®¡ç†

---

## 8. å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£
- [Anthropic API Documentation](https://docs.anthropic.com)
- [Claude Tool Use Guide](https://docs.anthropic.com/claude/docs/tool-use)
- [Model Context Protocol](https://modelcontextprotocol.io)

### é¡¹ç›®æ–‡ä»¶
- `claude_agent.py` - Claude è‡ªä¸»ä»£ç†å®ç°
- `mcp_sdk.py` - MCP å®¢æˆ·ç«¯ SDK
- `demo_mcp_tools.py` - MCP å·¥å…·æ¼”ç¤º
- `README_CLAUDE_AGENT.md` - è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
- `é¡¹ç›®è¯´æ˜.md` - æ¶æ„è¯´æ˜

### ç›¸å…³æŠ€æœ¯
- **SSE (Server-Sent Events)**: æœåŠ¡å™¨æ¨é€æŠ€æœ¯
- **JSON Schema**: API å‚æ•°å®šä¹‰æ ‡å‡†
- **Agentic Loop**: AI Agent çš„å†³ç­–å¾ªç¯æ¨¡å¼

---

## é™„å½•

### A. å¯ç”¨å·¥å…·åˆ—è¡¨

| ç«¯å£ | å·¥å…·åç§° | åŠŸèƒ½æè¿° | æ•°æ®æº |
|------|---------|---------|--------|
| 6000 | Crossref | æœç´¢å­¦æœ¯æ–‡çŒ®å…ƒæ•°æ® | Crossref API |
| 6001 | BioC | è·å–ç”Ÿç‰©åŒ»å­¦æ–‡çŒ® | PubMed Central |
| 6002 | DeepResearch | ç»¼åˆå­¦æœ¯æœç´¢ | é›†æ€è°± |
| 6003 | Arxiv Abstract | é€šè¿‡æ‘˜è¦æœç´¢è®ºæ–‡ | arXiv |
| 6004 | OpenLibrary | æœç´¢å›¾ä¹¦ä¿¡æ¯ | Open Library |
| 6005 | Entrez | æœç´¢ NCBI æ•°æ®åº“ | NCBI |
| 6006 | Arxiv ID | é€šè¿‡ ID æŸ¥æ‰¾è®ºæ–‡ | arXiv |
| 6007 | Arxiv Title | é€šè¿‡æ ‡é¢˜æœç´¢è®ºæ–‡ | arXiv |

### B. ä»£ç ç»Ÿè®¡

| æ–‡ä»¶ | è¡Œæ•° | åŠŸèƒ½ |
|------|------|------|
| `claude_agent.py` | ~490 | Claude ä»£ç†æ ¸å¿ƒé€»è¾‘ |
| `mcp_sdk.py` | ~70 | MCP å®¢æˆ·ç«¯å°è£… |
| `demo_mcp_tools.py` | ~150 | å·¥å…·æ¼”ç¤ºè„šæœ¬ |
| `test_mcp_tools.py` | ~120 | æœåŠ¡æµ‹è¯•è„šæœ¬ |
| **æ€»è®¡** | **~830** | |

### C. æµ‹è¯•ç»“æœ

```
âœ… MCP æœåŠ¡è¿æ¥æµ‹è¯•
   - ç«¯å£ 6002 (DeepResearch): é€šè¿‡
   - å…¶ä»–ç«¯å£: å¾…æµ‹è¯•

âš ï¸ Claude API è¿æ¥æµ‹è¯•
   - å®˜æ–¹ API: æœªæµ‹è¯•
   - ä¸­è½¬ API: è¿æ¥å¤±è´¥ï¼ˆSSL é”™è¯¯ï¼‰

âœ… ä»£ç æ¶æ„éªŒè¯
   - å·¥å…·å®šä¹‰: å®Œæˆ
   - å†³ç­–å¾ªç¯: å®Œæˆ
   - å·¥å…·æ‰§è¡Œ: å®Œæˆ
```

---

**æŠ¥å‘Šå®Œæˆæ—¶é—´**: 2026å¹´2æœˆ3æ—¥
**ç‰ˆæœ¬**: v1.0
**çŠ¶æ€**: æ ¸å¿ƒåŠŸèƒ½å·²å®ç°ï¼Œå¾… API è¿æ¥é—®é¢˜è§£å†³åè¿›è¡Œå®Œæ•´æµ‹è¯•
